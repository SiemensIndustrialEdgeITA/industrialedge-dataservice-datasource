/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","@grafana/runtime","lodash"],(function(e,t,n,r,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=52)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){var r=n(19),a=n(13),o=n(36),i=n(37),u=Object.prototype,s=u.hasOwnProperty,c=r((function(e,t){e=Object(e);var n=-1,r=t.length,c=r>2?t[2]:void 0;for(c&&o(t[0],t[1],c)&&(r=1);++n<r;)for(var l=t[n],f=i(l),p=-1,d=f.length;++p<d;){var g=f[p],h=e[g];(void 0===h||a(h,u[g])&&!s.call(e,g))&&(e[g]=l[g])}return e}));e.exports=c},function(e,t,n){var r=n(11),a=n(29),o=n(30),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?a(e):o(e)}},function(e,t,n){var r=n(12),a="object"==typeof self&&self&&self.Object===Object&&self,o=r||a||Function("return this")();e.exports=o},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(6),a=n(4);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){var r=n(7).Symbol;e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(28))},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(10),a=n(15);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=a},function(e,t,n){var r=n(9),a=n(20),o=n(22);e.exports=function(e,t){return o(a(e,t,r),e+"")}},function(e,t,n){var r=n(21),a=Math.max;e.exports=function(e,t,n){return t=a(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,u=a(o.length-t,0),s=Array(u);++i<u;)s[i]=o[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=o[i];return c[t]=n(s),r(e,this,c)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(23),a=n(35)(r);e.exports=a},function(e,t,n){var r=n(24),a=n(25),o=n(9),i=a?function(e,t){return a(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=i},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var r=n(26),a=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=a},function(e,t,n){var r=n(27),a=n(34);e.exports=function(e,t){var n=a(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(10),a=n(31),o=n(4),i=n(33),u=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,l=s.toString,f=c.hasOwnProperty,p=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||a(e))&&(r(e)?p:u).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(11),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,u=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,u),n=e[u];try{e[u]=void 0;var r=!0}catch(e){}var a=i.call(e);return r&&(t?e[u]=n:delete e[u]),a}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,a=n(32),o=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(7)["__core-js_shared__"];e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var a=n(),o=16-(a-r);if(r=a,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var r=n(13),a=n(14),o=n(16),i=n(4);e.exports=function(e,t,n){if(!i(n))return!1;var u=typeof t;return!!("number"==u?a(n)&&o(t,n.length):"string"==u&&t in n)&&r(n[t],e)}},function(e,t,n){var r=n(38),a=n(49),o=n(14);e.exports=function(e){return o(e)?r(e,!0):a(e)}},function(e,t,n){var r=n(39),a=n(40),o=n(42),i=n(43),u=n(16),s=n(45),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),l=!n&&a(e),f=!n&&!l&&i(e),p=!n&&!l&&!f&&s(e),d=n||l||f||p,g=d?r(e.length,String):[],h=g.length;for(var v in e)!t&&!c.call(e,v)||d&&("length"==v||f&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||u(v,h))||g.push(v);return g}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(41),a=n(8),o=Object.prototype,i=o.hasOwnProperty,u=o.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return a(e)&&i.call(e,"callee")&&!u.call(e,"callee")};e.exports=s},function(e,t,n){var r=n(6),a=n(8);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){(function(e){var r=n(7),a=n(44),o=t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o?r.Buffer:void 0,s=(u?u.isBuffer:void 0)||a;e.exports=s}).call(this,n(17)(e))},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(46),a=n(47),o=n(48),i=o&&o.isTypedArray,u=i?a(i):r;e.exports=u},function(e,t,n){var r=n(6),a=n(15),o=n(8),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&a(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(12),a=t&&!t.nodeType&&t,o=a&&"object"==typeof e&&e&&!e.nodeType&&e,i=o&&o.exports===a&&r.process,u=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=u}).call(this,n(17)(e))},function(e,t,n){var r=n(4),a=n(50),o=n(51),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=a(e),n=[];for(var u in e)("constructor"!=u||!t&&i.call(e,u))&&n.push(u);return n}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){"use strict";n.r(t);var r=n(2),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var c=n(3),l=n(18),f=n.n(l),p=n(5),d=n.n(p),g={variablesNames:"",variablesOptions:[],variablesRawMode:!1,from:"${__from:date}",to:"${__to:date}",order:"Ascending",aggregateMode:"None",aggregateTime:"None",aliases:""},h=[{label:"Ascending",value:"Ascending"},{label:"Descending",value:"Descending"}],v=[{label:"None",value:"None"},{label:"Last",value:"Last"},{label:"Max",value:"Max"},{label:"Min",value:"Min"},{label:"Average",value:"Average"},{label:"Sum",value:"Sum"},{label:"Counter",value:"Counter"}],m=[{label:"None",value:"None"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"30m",value:"30m"},{label:"1h",value:"1h"},{label:"12h",value:"12h"},{label:"1d",value:"1d"}],b=function(e){function t(t){var n=e.call(this,t)||this;return n.baseUrl=t.url,n.headers={"Content-Type":"application/json"},n.accessToken="",n.accessExpire=0,n.requestTokenBody={appName:"edgeappdataservice",appVersion:"1.1",hostTenant:"edge",userTenant:"edge"},n.userAPI="grafanaUser",n.passAPI="grafanaPass",n.createUserBody={userName:n.userAPI,passWord:n.passAPI,familyName:"grafanaFamily",givenName:"grafanaName",email:"grafana@example.com",roles:[{application:"edgeappdataservice",role:"admin"}]},n.aggregateBaseBody={from:"",to:"",dataSources:[],variableConfigurations:[{unit:"string",isAggregated:!0,acquisitionCategory:"ProcessValue",acquisitionCycle:{base:"acyclic",factor:0},counterConfigurations:[{validFrom:"2019-06-25T00:00:00.000Z",counterConstant:1,counterType:"UpCounter",triggeredReset:!1,rangeStart:0,rangeEnd:1e3,valueAtInstallation:null,valueAtReplacement:null}],limitsConfiguration:{isRawData:!1,aggregation:"None",calculationCycle:{base:"second",factor:1},limits:{high_alert:{threshold:0,activateNotification:!1,notificationConfigId:""},high_warning:{threshold:0,activateNotification:!1,notificationConfigId:""},low_alert:{threshold:0,activateNotification:!1,notificationConfigId:""},low_warning:{threshold:0,activateNotification:!1,notificationConfigId:""}}}}]},n.aggregateTimeMap={None:0,"1m":6e4,"5m":3e5,"10m":6e5,"30m":18e5,"1h":36e5,"12h":432e5,"1d":864e5},n.nameIdMaps={},n.idNameMaps={},n.idAssetMaps={},n.variablesOptions=[],n.start=0,n.initPlugin(),n}return o(t,e),t.prototype.initPlugin=function(){return u(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,this.getToken()];case 1:return e.sent(),[4,this.createAssetMap()];case 2:return e.sent(),[4,this.createVariablesMap()];case 3:return e.sent(),[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},t.prototype.getToken=function(){var e=this,t=this;return new Promise((function(n,r){t.customGetRequest("/TokenManagerService/users",{},"").then((function(a){if(0===a.data.filter((function(t){return t.userName===e.userAPI})).length)t.customRequest("/TokenManagerService/users",{},"post",t.createUserBody,"").then((function(e){var a={"X-SPACE-AUTH-KEY":"Basic "+btoa(t.userAPI+":"+t.passAPI)};t.customRequest("/TokenManagerService/oauth/token",a,"post",t.requestTokenBody,"").then((function(e){t.accessToken=e.data.access_token,t.accessExpire=1e3*(Math.floor((new Date).getTime()/1e3)+e.data.expires_in),n(!0)}),(function(e){r(e)}))}),(function(e){r(e)}));else{var o={"X-SPACE-AUTH-KEY":"Basic "+btoa(t.userAPI+":"+t.passAPI)};t.customRequest("/TokenManagerService/oauth/token",o,"post",t.requestTokenBody,"").then((function(e){t.accessToken=e.data.access_token,t.accessExpire=1e3*(Math.floor((new Date).getTime()/1e3)+e.data.expires_in-120),n(!0)}),(function(e){r(e)}))}}),(function(e){r(e)}))}))},t.prototype.createAssetMap=function(){""===this.accessToken&&this.getToken().then((function(e){}),(function(e){}));var e=this;return new Promise((function(t,n){e.customGetRequest("/AssetService/Assets",{Authorization:e.accessToken},"").then((function(n){if(n.data.hasOwnProperty("assets")){for(var r=0;r<n.data.assets.length;r++)e.idAssetMaps[n.data.assets[r].assetId]=n.data.assets[r].name;t(!0)}else t(!1)}),(function(e){n(!1)}))}))},t.prototype.createVariablesMap=function(){var e=this;""===this.accessToken&&this.getToken().then((function(e){}),(function(e){}));var t=this;return new Promise((function(n,r){t.customGetRequest("/DataService/Variables",{Authorization:t.accessToken},"").then((function(r){if(r.data.hasOwnProperty("variables")){for(var a=0;a<r.data.variables.length;a++){var o=e.idAssetMaps[r.data.variables[a].assetId]+"."+r.data.variables[a].variableName;t.nameIdMaps[o]=r.data.variables[a].variableId,t.idNameMaps[r.data.variables[a].variableId]=o}n(!0)}else n(!1)}),(function(e){r(!1)}))}))},t.prototype.createVariablesOptions=function(){var e=this;""===this.accessToken&&this.getToken().then((function(e){}),(function(e){}));var t=this;return t.variablesOptions=[],new Promise((function(n,r){t.customGetRequest("/DataService/Variables",{Authorization:t.accessToken},"").then((function(r){if(r.data.hasOwnProperty("variables")){for(var a=0;a<r.data.variables.length;a++){var o=e.idAssetMaps[r.data.variables[a].assetId]+"."+r.data.variables[a].variableName;t.variablesOptions.push({label:o,value:o})}t.variablesOptions.sort((function(e,t){return"string"==typeof e.value&&"string"==typeof t.value?e.value.localeCompare(t.value):0})),n(t.variablesOptions)}else n([])}),(function(e){r(!1)}))}))},t.prototype.queryData=function(e,t,n,r,a,o){var i=this;return new Promise((function(u,s){var c=[],l={},f="variableIds="+n+"&from="+r+"&to="+a+"&order="+o;i.customGetRequest("/DataService/Data",{Authorization:i.accessToken},f).then((function(n){for(var r=n.data.data,a=-1,o=0;o<r.length;o++){l[r[o].variableId]=new Array(2e3*r.length).fill(null);for(var i=0;i<r[o].values.length;i++)-1===(a=c.indexOf(r[o].values[i].timestamp))&&(c.push(r[o].values[i].timestamp),e.push(r[o].values[i].timestamp),a=c.length-1),l[r[o].variableId][a]=r[o].values[i].value}for(var s=0;s<r.length;s++)t[r[s].variableId]=t[r[s].variableId].concat(l[r[s].variableId].slice(0,c.length));n.data.hasOwnProperty("hasMoreData")?u({queryFinished:!1,queryFrom:n.data.hasMoreData.from,queryTo:n.data.hasMoreData.to,timeBuffer:e,dataBuffer:t}):u({queryFinished:!0,queryFrom:"",queryTo:"",timeBuffer:e,dataBuffer:t})}),(function(e){s(!1)}))}))},t.prototype.queryDataAggregateTrend=function(e,t,n,r,a,o,u){var s=this,c=this;return new Promise((function(l,f){var p=[],d={},g=i(i({},s.aggregateBaseBody),{from:r,to:a,calculationTimeRange:u,dataSources:[]});n.replace(/"/g,"").replace("[","").replace("]","").split(",").forEach((function(e){g.dataSources.push({type:"Variable",id:e,aggregation:o})})),c.customRequest("/DataService/CalculateTrend",{Authorization:c.accessToken},"post",g,"").then((function(n){for(var r=n.data,a=-1,o=0;o<r.length;o++){d[r[o].dataSource.id]=new Array(2e3*r.length).fill(null);for(var i=0;i<r[o].values.length;i++)-1===(a=p.indexOf(r[o].values[i].timestamp))&&(p.push(r[o].values[i].timestamp),e.push(r[o].values[i].timestamp),a=p.length-1),d[r[o].dataSource.id][a]=r[o].values[i].value}for(var u=0;u<r.length;u++)t[r[u].dataSource.id]=t[r[u].dataSource.id].concat(d[r[u].dataSource.id].slice(0,p.length));n.data.hasOwnProperty("hasMoreData")?l({queryFinished:!1,queryFrom:n.data.hasMoreData.from,queryTo:n.data.hasMoreData.to,timeBuffer:e,dataBuffer:t}):l({queryFinished:!0,queryFrom:"",queryTo:"",timeBuffer:e,dataBuffer:t})}),(function(e){f(!1)}))}))},t.prototype.queryDataAggregate=function(e,t,n,r,a,o){var u=this,s=this;return new Promise((function(c,l){var f=i(i({},u.aggregateBaseBody),{from:r,to:a,dataSources:[]});n.replace(/"/g,"").replace("[","").replace("]","").split(",").forEach((function(e){f.dataSources.push({type:"Variable",id:e,aggregation:o})})),s.customRequest("/DataService/Calculate",{Authorization:s.accessToken},"post",f,"").then((function(n){for(var r=n.data,o=0;o<r.length;o++)t[r[o].dataSource.id]=[r[o].value],-1===e.indexOf(a)&&e.push(a);c({queryFinished:!0,timeBuffer:e,dataBuffer:t})}),(function(e){l(!1)}))}))},t.prototype.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.prototype.queryLoop=function(e,t,n,r,a,o,i,c,l){return u(this,void 0,void 0,(function(){var i,u,f,p,d,g;return s(this,(function(s){switch(s.label){case 0:i=!1,u=r,f=a,p=e,d=t,g=1,s.label=1;case 1:return!i&&g<1e4?[4,this.delay(200)]:[3,4];case 2:s.sent(),"None"===c&&0===l?this.queryData(p,d,n,u,f,o).then((function(e){p=e.timeBuffer,d=e.dataBuffer,e.queryFinished?i=!0:(u=e.queryFrom,f=e.queryTo)})).catch((function(e){})):0!==l?this.queryDataAggregateTrend(p,d,n,u,f,c,l).then((function(e){p=e.timeBuffer,d=e.dataBuffer,e.queryFinished?i=!0:(u=e.queryFrom,f=e.queryTo)})).catch((function(e){})):this.queryDataAggregate(p,d,n,u,f,c).then((function(e){p=e.timeBuffer,d=e.dataBuffer,e.queryFinished&&(i=!0)})).catch((function(e){})),s.label=3;case 3:return g++,[3,1];case 4:return[2,{timeBuffer:p,dataBuffer:d}]}}))}))},t.prototype.query=function(e){return u(this,void 0,Promise,(function(){var t,n=this;return s(this,(function(a){return t=e.targets.map((function(t){return u(n,void 0,void 0,(function(){var n,a,o,i,u,l,f,p,h,v,m,b,y,w,T,x,A,O,j,S,C,q,M,P,N=this;return s(this,(function(s){switch(s.label){case 0:return n=d()(t,g),a=[],(new Date).getTime()>this.accessExpire||""===this.accessToken?[4,this.getToken()]:[3,5];case 1:return s.sent(),[4,this.createAssetMap()];case 2:return s.sent(),[4,this.createVariablesMap()];case 3:return s.sent(),[4,this.createVariablesOptions()];case 4:s.sent(),s.label=5;case 5:if(""===this.accessToken)return[3,7];for(o=Object(c.getTemplateSrv)().replace(n.variablesNames,e.scopedVars,"csv"),i=Object(c.getTemplateSrv)().replace(n.from,e.scopedVars),u=Object(c.getTemplateSrv)().replace(n.to,e.scopedVars),l="Descending"===n.order?"Descending":"Ascending",f=""!==n.aliases?Object(c.getTemplateSrv)().replace(n.aliases,e.scopedVars,"csv").split(","):[],p=n.aggregateMode,h=this.aggregateTimeMap[n.aggregateTime],v=[],m=new RegExp(" , | ,|, ","g"),b=!1;!b;)m.test(o)?o=o.replace(/ , | ,|, /g,","):(b=!0,v=o.split(","));return y=v.map((function(e){return N.nameIdMaps[e]})),-1===v.indexOf("")&&y.length>0&&-1===y.indexOf(void 0)&&-1===y.indexOf(null)&&-1===y.indexOf("undefined")&&new Date(i).getTime()>0&&new Date(u).getTime()>0&&new Date(i).getTime()<new Date(u).getTime()?(i=new Date(i).toISOString(),u=new Date(u).getTime()>(new Date).getTime()?(new Date).toISOString():new Date(u).toISOString(),w='["'+y.join('","')+'"]',T={},y.map((function(e){return T[e]=[]})),x=[],[4,this.queryLoop(x,T,w,i,u,l,f,p,h)]):[3,7];case 6:if(A=s.sent(),O=[],A){for(j=0;j<A.timeBuffer.length;j++)O[j]=new Date(A.timeBuffer[j]).getTime();for(P in S=Array.from(O.keys()),S="Ascending"===l?S.sort((function(e,t){return Number(O[e])-Number(O[t])})):S.sort((function(e,t){return Number(O[t])-Number(O[e])})),a=[{name:"Time",type:r.FieldType.time,values:S.map((function(e){return O[e]}))}],C=0,q=function(e){var t=f.length>=C+1?f[C]:"None"!==p?M.idNameMaps[e]+"_"+p:M.idNameMaps[e];a.push({name:t,type:r.FieldType.number,values:S.map((function(t){return A.dataBuffer[e][t]}))}),C+=1},M=this,A.dataBuffer)q(P)}s.label=7;case 7:return[2,new r.MutableDataFrame({refId:n.refId,fields:a})]}}))}))})),[2,Promise.all(t).then((function(e){return{data:e}}))]}))}))},t.prototype.customRequest=function(e,t,n,r,a){return u(this,void 0,void 0,(function(){var o;return s(this,(function(u){return o=i(i({},this.headers),t),"get"!==n?[2,Object(c.getBackendSrv)().datasourceRequest({url:""+this.baseUrl+e,headers:o,method:n,data:r,responseType:"json"})]:[2,this.customGetRequest(e,o,a)]}))}))},t.prototype.customGetRequest=function(e,t,n){return u(this,void 0,void 0,(function(){var r;return s(this,(function(a){return r=i(i({},this.headers),t),[2,Object(c.getBackendSrv)().datasourceRequest({url:""+this.baseUrl+e+((null==n?void 0:n.length)?"?"+n:""),headers:r,method:"get",responseType:"json"})]}))}))},t.prototype.testDatasource=function(){return u(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(a){switch(a.label){case 0:e="Cannot connect to API",a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.customGetRequest("/TokenManagerService/users",{},"")];case 2:return 200===(t=a.sent()).status?[2,{status:"success",message:"Success"}]:[2,{status:"error",message:t.statusText?t.statusText:e}];case 3:return n=a.sent(),f.a.isString(n)?[2,{status:"error",message:n}]:(r="",r+=n.statusText?n.statusText:e,n.data&&n.data.error&&n.data.error.code&&(r+=": "+n.data.error.code+". "+n.data.error.message),[2,{status:"error",message:r}]);case 4:return[2]}}))}))},t}(r.DataSourceApi),y=n(1),w=n(0),T=n.n(w),x=y.LegacyForms.FormField,A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFromChange=function(e){var n=t.props,r=n.onChange,a=n.onRunQuery,o=n.query;r(i(i({},o),{from:e.target.value})),a()},t.onToChange=function(e){var n=t.props,r=n.onChange,a=n.onRunQuery,o=n.query;r(i(i({},o),{to:e.target.value})),a()},t.onRawModeChange=function(e){var n=t.props,r=n.onChange,a=n.query;r(i(i({},a),{variablesRawMode:Boolean(e.target.checked)}))},t.onNamesChange=function(e){var n=t.props,r=n.onChange,a=n.onRunQuery,o=n.query;r(i(i({},o),{variablesNames:e.target.value})),a()},t.onMultiNamesChange=function(e){var n=e.map((function(e){return e.value})).join(),r=t.props,a=r.onChange,o=r.onRunQuery,u=r.query;a(i(i({},u),{variablesNames:n})),o()},t.onAliasesChange=function(e){var n=t.props,r=n.onChange,a=n.onRunQuery,o=n.query;r(i(i({},o),{aliases:e.target.value})),a()},t.onOrderChange=function(e){var n=void 0!==e.value?e.value:"Ascending",r=t.props,a=r.onChange,o=r.onRunQuery,u=r.query;a(i(i({},u),{order:n})),o()},t.onAggregateModeChange=function(e){var n=void 0!==e.value?e.value:"None",r=t.props,a=r.onChange,o=r.onRunQuery,u=r.query;a(i(i({},u),{aggregateMode:n})),o()},t.onAggregateTimeChange=function(e){var n=void 0!==e.value?e.value:"None",r=t.props,a=r.onChange,o=r.onRunQuery,u=r.query;a(i(i({},u),{aggregateTime:n})),o()},t}return o(t,e),t.prototype.render=function(){var e=this,t=d()(this.props.query,g),n=t.from,r=t.to,a=t.order,o=t.variablesNames,u=t.variablesOptions,s=t.variablesRawMode,c=t.aliases,l=t.aggregateMode,f=t.aggregateTime;return T.a.createElement(T.a.Fragment,null,T.a.createElement("div",{className:"gf-form-inline"},T.a.createElement("div",{className:"gf-form"},T.a.createElement(x,{width:10,labelWidth:10,value:n||"",onChange:this.onFromChange,label:"From",tooltip:"Start datetime for query."})),T.a.createElement("div",{className:"gf-form"},T.a.createElement(x,{width:10,labelWidth:10,value:r||"${__from:date}",onChange:this.onToChange,label:"To",tooltip:"End datetime for query."}))),T.a.createElement("div",{className:"gf-form-inline"},T.a.createElement(y.InlineField,{labelWidth:20,label:"Variables",tooltip:"For Variables Names property."},T.a.createElement(y.InlineSwitch,{label:"Text Mode",showLabel:!0,value:s,onChange:this.onRawModeChange})),T.a.createElement("div",{className:"gf-form"},s?T.a.createElement(y.Input,{width:50,value:o||"",onChange:this.onNamesChange}):T.a.createElement(y.MultiSelect,{width:50,menuPlacement:"bottom",allowCustomValue:!1,options:u,onOpenMenu:function(){e.props.datasource.createVariablesOptions().then((function(n){e.props.onChange(i(i({},t),{variablesOptions:n}))}))},value:u.filter((function(e){return"string"==typeof e.value&&o.includes(e.value)})),onChange:function(t){return e.onMultiNamesChange(t)}}))),T.a.createElement("div",{className:"gf-form-inline"},T.a.createElement("div",{className:"gf-form"},T.a.createElement(x,{width:50,labelWidth:10,value:c||"",onChange:this.onAliasesChange,label:"Aliases",tooltip:"List of aliases to be applied on the results Variables Names."}))),T.a.createElement("div",{className:"gf-form-inline"},T.a.createElement("div",{className:"gf-form"},T.a.createElement(y.InlineField,{labelWidth:20,label:"Order",tooltip:"Ascending or Descending."},T.a.createElement(y.Select,{width:16,menuPlacement:"bottom",allowCustomValue:!1,options:h,value:h.find((function(e){return e.value===a})),onChange:this.onOrderChange})))),T.a.createElement("div",{className:"gf-form-inline"},T.a.createElement("div",{className:"gf-form"},T.a.createElement(y.InlineField,{labelWidth:20,label:"Aggregate Mode",tooltip:"Aggregate function to be applied on data."},T.a.createElement(y.Select,{width:16,menuPlacement:"bottom",allowCustomValue:!1,options:v,value:v.find((function(e){return e.value===l})),onChange:this.onAggregateModeChange})),T.a.createElement(y.InlineField,{labelWidth:20,label:"Aggregate Time",tooltip:"Time range for data groups aggregation. None will use the whole time range."},T.a.createElement(y.Select,{width:16,menuPlacement:"bottom",allowCustomValue:!1,options:m,value:m.find((function(e){return e.value===f})),onChange:this.onAggregateTimeChange})))))},t}(w.PureComponent);n.d(t,"plugin",(function(){return O}));var O=new r.DataSourcePlugin(b).setConfigEditor((function(e){var t=e.onOptionsChange,n=e.options;return T.a.createElement(y.DataSourceHttpSettings,{defaultUrl:"http://edgeappdataservice:4203",dataSourceConfig:n,onChange:t,showForwardOAuthIdentityOption:!1,showAccessOptions:!1,sigV4AuthToggleEnabled:!1})})).setQueryEditor(A)}])}));
//# sourceMappingURL=module.js.map